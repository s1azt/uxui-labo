import{i as f,s as m,x as p,j as y}from"./lit-element-C4bBeaiV.js";import{n as a}from"./property-BacG-Vag.js";import{r as h}from"./state-CLgbQenF.js";import{e as c}from"./query-DXShiZ7f.js";import{E as g}from"./element-BmCHZ0P_.js";import{m as b}from"./delegate-CzAH-NQ8.js";import{m as v,g as w,V as O}from"./validator-Z-Is_xbn.js";import{m as x}from"./element-internals-CBp_Vcyn.js";import{m as C}from"./form-associated-C1RJQ55l.js";import{m as k,o as S}from"./on-report-validity-Dy401omy.js";import"./Icon-CzSa45Vk.js";import{c as E}from"./calculateSize-BEzCU_f7.js";import{S as V}from"./constants-rkZZCW-e.js";var R=Object.defineProperty,s=(n,t,e,o)=>{for(var r=void 0,l=n.length-1,d;l>=0;l--)(d=n[l])&&(r=d(t,e,r)||r);return r&&R(t,e,r),r};const T=b(k(v(C(x(g))))),$=n=>/^\{\s*(?:([^={},]+=[^,]+)(,\s*[^={},]+=[^,]+)*)?\s*\}$/u.test(n),F=n=>{const t=n.slice(1,-1).trim();return t?t.split(/\s*,\s*/).map(e=>{const o=e.indexOf("=");if(o===-1)return{value:e.trim(),label:void 0};const r=e.slice(0,o).trim(),l=e.slice(o+1).trim();return{value:r,label:l}}):[]},D={converter(n,t){if(!n)return[];if($(n))return n==="{}"?[]:F(n);try{return JSON.parse(n)}catch(o){return console.error(`[optionsConverter] 形式に失敗: "${n}"`,o),[]}}},u=class u extends T{constructor(){super(f`
      :host {
        display: inline-block;
      }
    `.cssText),this.focused=!1,this.showDropdown=!1,this.searchText="",this.filteredOptions=[],this.placeholder="",this.required=!1,this.readonly=!1,this.width="240",this.error=!1,this.searchable=!1,this.options=[],this.size=1,this.autocomplete="on",this.calcHeight=38,this.dropdownListPosition={top:0,left:0},this.animationFrameId=null,this.previousRect=null,this.intersectionObserver=null,this.isVisible=!0,this.fixSize=!0,this.handleOutsideClick=t=>{var l,d;const e={x:t.clientX,y:t.clientY},o=(l=this.container)==null?void 0:l.getBoundingClientRect(),r=(d=this.container)==null?void 0:d.querySelector("#select-dropdown-list");o&&r&&(e.x<o.left||e.x>o.right||e.y<o.top||e.y>o.bottom+(r==null?void 0:r.clientHeight))&&(this.showDropdown=!1)},this.handleEscapeKey=t=>{t.key==="Escape"&&(this.showDropdown=!1)},window.addEventListener("click",this.handleOutsideClick.bind(this)),window.addEventListener("keydown",this.handleEscapeKey.bind(this)),this.addEventListener("focus",this.handleFocus.bind(this)),this.addEventListener("blur",this.handleBlur.bind(this))}handleFocus(){this.focused=!0}handleBlur(){this.focused=!1}toggleDropdown(){this.disabled||this.readonly||(this.showDropdown=!this.showDropdown,this.filteredOptions=this.options,this.showDropdown&&this.trigger&&V)}handleSearchInput(t){const e=t.target;this.searchText=e.value.toLowerCase(),this.filteredOptions=this.options.filter(o=>o.label.toLowerCase().includes(this.searchText))}dispatchSelectEvents(){const t=new Event("input",{bubbles:!0,composed:!0});Object.defineProperty(t,"target",{writable:!1,value:this}),this.dispatchEvent(t);const e=new Event("change",{bubbles:!0,composed:!0});Object.defineProperty(e,"target",{writable:!1,value:this}),this.dispatchEvent(e)}updateTrackingPosition(){this.isVisible||(this.showDropdown=!1);const t=this.getBoundingClientRect();(!this.previousRect||t.top!==this.previousRect.top||t.left!==this.previousRect.left||t.width!==this.previousRect.width||t.height!==this.previousRect.height)&&(this.dropdownListPosition={top:t.bottom,left:t.left},this.previousRect=t),this.animationFrameId=requestAnimationFrame(()=>this.updateTrackingPosition())}startTracking(){this.animationFrameId||this.updateTrackingPosition()}stopTracking(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}startObservingTriggerVisibility(){this.trigger&&(this.intersectionObserver=new IntersectionObserver(t=>{for(const e of t)e.target===this.trigger&&(this.isVisible=e.isIntersecting,this.isVisible||(this.showDropdown=!1))},{root:null,threshold:.1}),this.intersectionObserver.observe(this.trigger))}connectedCallback(){super.connectedCallback(),console.log("connectedCallback"),this.startTracking()}disconnectedCallback(){super.disconnectedCallback(),this.stopTracking(),this.intersectionObserver&&this.intersectionObserver.disconnect()}firstUpdated(){this.headerKey!=null&&this.headerValue!=null&&this.options.unshift({label:this.headerValue,value:this.headerKey}),this.filteredOptions=this.options,this.startObservingTriggerVisibility()}updated(t){super.updated(t),this.style.setProperty("width",String(E(this==null?void 0:this.width))||"auto"),t.has("options")&&(this.filteredOptions=this.options)}renderSearchBox(){return p`
      <input
        ?hidden=${!this.searchable}
        type="text"
        id="select"
        placeholder="検索..."
        class="w-full p-2 outline-none"
        .value="${this.searchText}"
        @input="${this.handleSearchInput}"
        ?required="${this.required}"
        ?readonly="${this.readonly}"
        ?disabled="${this.disabled}"
      />
    `}renderDropdown(){var e,o;const t=(o=(e=this.shadowRoot)==null?void 0:e.host)==null?void 0:o.getBoundingClientRect().width;return p`
      <div
        class="dropdown-list bg-white border mt-1 max-h-48 overflow-auto z-10 w-full"
        id="select-dropdown-list"
        style="position: ${"absolute"}; visibility: ${this.showDropdown?"visible":"hidden"};width:${t+"px"};top:${"100%"};left:${0}"
      >
        ${this.renderSearchBox()}
        ${this.filteredOptions.map(r=>this.renderOption(r))}
        ${this.filteredOptions.length===0?p`<div class="p-2 text-gray-500">
              一致する選択肢がありません
            </div>`:null}
      </div>
    `}[w](){return this.select}[S](t){}};u.shadowRootOptions={...m.shadowRootOptions,delegatesFocus:!0};let i=u;s([h()],i.prototype,"focused");s([h()],i.prototype,"showDropdown");s([h()],i.prototype,"searchText");s([h()],i.prototype,"filteredOptions");s([a({type:String})],i.prototype,"placeholder");s([a({type:Boolean})],i.prototype,"required");s([a({type:Boolean})],i.prototype,"readonly");s([a({type:String})],i.prototype,"width");s([a({type:Boolean,reflect:!0})],i.prototype,"error");s([a({type:Boolean})],i.prototype,"searchable");s([a(D)],i.prototype,"options");s([a({type:Number})],i.prototype,"size");s([a({type:String})],i.prototype,"autocomplete");s([a({type:String,attribute:"header-key"})],i.prototype,"headerKey");s([a({type:String,attribute:"header-value"})],i.prototype,"headerValue");s([c("select")],i.prototype,"select");s([c("#trigger")],i.prototype,"trigger");s([c("#container")],i.prototype,"container");s([h()],i.prototype,"dropdownListPosition");s([h()],i.prototype,"fixSize");/**
 * @license
 * Copyright 2023 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class N extends O{computeValidity(t){return this.selectControl||(this.selectControl=document.createElement("select")),y(p`<option value=${t.value}></option>`,this.selectControl),this.selectControl.value=t.value,this.selectControl.required=t.required,{validity:this.selectControl.validity,validationMessage:this.selectControl.validationMessage}}equals(t,e){return t.value===e.value&&t.required===e.required}copy({value:t,required:e}){return{value:t,required:e}}}export{i as B,N as S};
